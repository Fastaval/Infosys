import{_ as se,j as oe,r as d,o as ne,a as ie,b as m,k as de,c as L,d as ue,f as n,w as u,g as M,h as R,F as re,l as $,t as r,n as A,m as H,e as a,q as B,s as pe,p as ve,i as ce}from"./index-ca2caa21.js";import{g as me,a as ge,b as _e,d as ke,u as be,e as ye}from"./users.service-f75ac69f.js";const i=U=>(ve("data-v-8f50648d"),U=U(),ce(),U),fe={style:{display:"flex",float:"right",gap:"1rem"}},xe={style:{display:"flex"}},we={style:{width:"100%","white-space":"pre-wrap"}},he={class:"ticket-details"},Te=i(()=>a("span",null,"Oprettet:",-1)),Ve=i(()=>a("span",null,"Ændret:",-1)),Ue=i(()=>a("span",null,"Prioritet:",-1)),Ce=i(()=>a("span",null,"Oprettet af:",-1)),De=i(()=>a("span",null,"Udføres af:",-1)),Ie={class:"p-text-secondary"},Le=i(()=>a("h4",null,"Rediger opgave",-1)),Se={style:{display:"grid","grid-template-columns":"minmax(400px, 800px) minmax(150px, 300px)",gap:"1rem"}},Me={style:{display:"flex","flex-direction":"column"}},Re=i(()=>a("label",{class:"help-text"},"Navn/Titel",-1)),$e=i(()=>a("label",{class:"help-text"},"Opgavebeskrivelse",-1)),Be={style:{display:"flex","flex-direction":"column","background-color":"#eee",padding:"1rem",height:"min-content","padding-bottom":"1.5rem","border-radius":"4px"}},Oe=i(()=>a("label",{class:"help-text"},"Status",-1)),Fe=i(()=>a("label",{class:"help-text"},"Kategori",-1)),Ne=i(()=>a("label",{class:"help-text"},"Prioritet",-1)),ze=i(()=>a("label",{class:"help-text"},"Udføres af",-1)),Ge={style:{display:"inline-flex",gap:"1rem"}},qe=i(()=>a("label",{class:"help-text"},"Besked",-1)),Ee={style:{display:"inline-flex",gap:"1rem"}},Pe={__name:"Ticket",setup(U){const O=oe(),F=d(),l=d(),s=d(),y=d(),N=d(),f=d(!1),x=d(!1),z=d("new"),_=d(!1),w=d(),k=d(),v=d();let G=[{label:"Lukket",options:[{label:"Annulleret",open:0,status:0},{label:"Godkendt",open:0,status:1},{label:"Kan/vil ikke lave",open:0,status:2}]},{label:"Åben",options:[{label:"Oprettet",open:1,status:0},{label:"Startet",open:1,status:1},{label:"Skal testes",open:1,status:2},{label:"Venter",open:1,status:3}]}];const J=()=>{var h,p,C,D,I,T,g,V,b,e;const o=(l==null?void 0:l.value.open)===1?(p=(h=v.value.tickets)==null?void 0:h.open)==null?void 0:p.da:(D=(C=v.value.tickets)==null?void 0:C.closed)==null?void 0:D.da,t=l.value.open===1?(g=(T=(I=v.value.tickets)==null?void 0:I.status)==null?void 0:T.open[l.value.status])==null?void 0:g.da:(e=(b=(V=v.value.tickets)==null?void 0:V.status)==null?void 0:b.closed[l.value.status])==null?void 0:e.da;return{pt:{root:{class:`p-badge p-badge-${l.value.open===1?"success":"secondary"}`}},label:`${o} - ${t}`}},Q=()=>({pt:{root:{class:"p-badge p-badge-info"}},label:v.value.tickets.category[l.value.category].da}),W=()=>{s.value={...s.value,open:w.value.open,status:w.value.status}},X=async()=>{_.value=!0,await be(s.value).then(async()=>{await E(),f.value=!1,_.value=!1})},Y=async()=>{_.value=!0,await ye(y.value).then(async()=>{await P(),x.value=!1,_.value=!1})},Z=()=>{s.value={...l.value},f.value=!0,w.value=G[l.value.open].options[l.value.status]},q=o=>{y.value={...o,ticket:l.value.id},z.value=o?"edit":"new",x.value=!0},E=async()=>await _e(O.params.id).then(o=>l.value=o.tickets[O.params.id]),P=async()=>await ke(l.value.id).then(o=>N.value=o.messages),ee=()=>!s.value.name||!s.value.description||!s.value.assignee,te=()=>!y.value,ae=o=>k.value.find(t=>t.id===o).name,le=o=>new Intl.DateTimeFormat("en-GB",{dateStyle:"short",timeStyle:"medium"}).format(new Date(o*1e3)).replace(",","");return ne(async()=>{await me().then(o=>v.value=o),k.value=Object.values(await ge()),await E(),await P()}),ie(async()=>{var o;return F.value=(o=window==null?void 0:window.infosys)==null?void 0:o.user_id}),(o,t)=>{const j=m("RouterLink"),h=m("Chip"),p=m("Button"),C=m("Card"),D=m("Timeline"),I=m("InputText"),T=m("Textarea"),g=m("Dropdown"),V=m("Dialog"),b=de("tooltip");return L(),ue(re,null,[n(j,{to:"/",style:{"margin-bottom":"1rem",display:"inline-flex"}},{default:u(()=>[$("← Tilbage ")]),_:1}),k.value&&l.value?(L(),M(C,{key:0},{title:u(()=>{var e;return[$(r((e=l.value)==null?void 0:e.name)+" ",1),n(h,A(H(J())),null,16),n(h,A(H(Q())),null,16),a("div",fe,[B(n(p,{icon:"pi pi-file-edit",onClick:t[0]||(t[0]=c=>Z()),outlined:"",raised:"",rounded:"",severity:"secondary",size:"small"},null,512),[[b,"Rediger opgave",void 0,{top:!0}]]),B(n(p,{icon:"pi pi-comment",raised:"",rounded:"",size:"small",onClick:t[1]||(t[1]=c=>q())},null,512),[[b,"Ny besked",void 0,{top:!0}]])])]}),content:u(()=>{var e,c,K;return[a("div",xe,[a("div",we,r(((e=l.value)==null?void 0:e.description)??"Ingen beskrivelse"),1),a("div",he,[Te,a("span",null,r(l.value.created?new Date(l.value.created*1e3).toLocaleString():"Ukendt"),1),Ve,a("span",null,r(l.value.last_edit?new Date(l.value.last_edit*1e3).toLocaleString():"-"),1),Ue,a("span",null,r(((K=(c=v.value)==null?void 0:c.tickets)==null?void 0:K.priority[l.value.priority].da)??"Ukendt"),1),Ce,a("span",null,r(k.value.find(S=>S.id===l.value.creator).name??"Ukendt"),1),De,a("span",null,r(k.value.find(S=>S.id===l.value.assignee).name??"Ukendt"),1)])])]}),_:1})):R("",!0),n(D,{value:N.value,style:{"padding-top":"1rem"}},{opposite:u(e=>[a("small",Ie,r(ae(e.item.user))+" | "+r(le(e.item.posted)),1)]),marker:u(e=>[e.item.user===F.value?B((L(),M(p,{key:0,class:"timeline-btn",icon:"pi pi-file-edit",raised:"",rounded:"",size:"small",onClick:c=>q(e.item)},null,8,["onClick"])),[[b,"Rediger din besked",void 0,{top:!0}]]):R("",!0)]),content:u(e=>[$(r(e.item.message),1)]),_:1},8,["value"]),s.value?(L(),M(V,{key:1,visible:f.value,"onUpdate:visible":t[11]||(t[11]=e=>f.value=e),modal:""},{header:u(()=>[Le]),footer:u(()=>[a("div",Ge,[n(p,{severity:"info",text:"",label:"Luk",icon:"pi pi-times",onClick:t[9]||(t[9]=e=>f.value=!1)}),n(p,{label:"Gem",raised:"",disabled:ee(),onClick:t[10]||(t[10]=e=>X()),loading:_.value},null,8,["disabled","loading"])])]),default:u(()=>[a("div",Se,[a("div",Me,[Re,n(I,{modelValue:s.value.name,"onUpdate:modelValue":t[2]||(t[2]=e=>s.value.name=e),modelModifiers:{trim:!0},required:"",style:{width:"400px"}},null,8,["modelValue"]),$e,n(T,{modelValue:s.value.description,"onUpdate:modelValue":t[3]||(t[3]=e=>s.value.description=e),modelModifiers:{trim:!0},autoResize:!0,rows:10,style:{width:"100%"},required:""},null,8,["modelValue"])]),a("div",Be,[Oe,n(g,{class:"status-select",modelValue:w.value,"onUpdate:modelValue":t[4]||(t[4]=e=>w.value=e),options:pe(G),optionLabel:"label",optionGroupLabel:"label",optionGroupChildren:"options",onChange:t[5]||(t[5]=e=>W())},null,8,["modelValue","options"]),Fe,n(g,{modelValue:s.value.category,"onUpdate:modelValue":t[6]||(t[6]=e=>s.value.category=e),options:v.value.tickets.category.map((e,c)=>({label:e.da,value:c})),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),Ne,n(g,{modelValue:s.value.priority,"onUpdate:modelValue":t[7]||(t[7]=e=>s.value.priority=e),options:v.value.tickets.priority.map((e,c)=>({label:e.da,value:c})),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),ze,n(g,{modelValue:s.value.assignee,"onUpdate:modelValue":t[8]||(t[8]=e=>s.value.assignee=e),options:k.value,resetFilterOnHide:!0,optionLabel:"name",optionValue:"id",filter:""},null,8,["modelValue","options"])])])]),_:1},8,["visible"])):R("",!0),n(V,{visible:x.value,"onUpdate:visible":t[14]||(t[14]=e=>x.value=e),modal:"",style:{width:"100%","max-width":"750px",margin:"0 10px"}},{header:u(()=>[a("h4",null,r(z.value==="new"?"Ny besked":"Rediger besked"),1)]),footer:u(()=>[a("div",Ee,[n(p,{severity:"info",text:"",label:"Luk",icon:"pi pi-times",onClick:t[13]||(t[13]=e=>x.value=!1)}),n(p,{label:"Gem",raised:"",disabled:te(),onClick:Y,loading:_.value},null,8,["disabled","loading"])])]),default:u(()=>[qe,n(T,{modelValue:y.value.message,"onUpdate:modelValue":t[12]||(t[12]=e=>y.value.message=e),modelModifiers:{trim:!0},autoResize:!0,rows:10,style:{width:"100%"},required:""},null,8,["modelValue"])]),_:1},8,["visible"])],64)}}},Ae=se(Pe,[["__scopeId","data-v-8f50648d"]]);export{Ae as default};
